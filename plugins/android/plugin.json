{
  "name": "android",
  "version": "0.0.1",
  "description": "Sets Android home/AVD paths inside the Devbox virtenv for reproducible, project-local Android tooling.",
  "env": {
    "ANDROID_USER_HOME": "{{ .Virtenv }}/android",
    "ANDROID_AVD_HOME": "{{ .Virtenv }}/android/avd",
    "ANDROID_EMULATOR_HOME": "{{ .Virtenv }}/android",
    "ANDROID_CONFIG_DIR": "{{ .DevboxDir }}",
    "ANDROID_DEVICES_DIR": "{{ .DevboxDir }}/devices",
    "ANDROID_DEVICES": "",
    "ANDROID_SCRIPTS_DIR": "{{ .Virtenv }}/scripts",
    "ANDROID_FLAKE_DIR": "{{ .Virtenv }}",
    "ANDROID_LOCAL_SDK": "0",
    "ANDROID_COMPILE_SDK": "36",
    "ANDROID_TARGET_SDK": "36",
    "ANDROID_DEFAULT_DEVICE": "max",
    "ANDROID_SYSTEM_IMAGE_TAG": "google_apis",
    "ANDROID_APP_APK": "app/build/outputs/apk/debug/app-debug.apk",
    "ANDROID_BUILD_TOOLS_VERSION": "36.1.0",
    "ANDROID_INCLUDE_NDK": "false",
    "ANDROID_NDK_VERSION": "27.0.12077973",
    "ANDROID_INCLUDE_CMAKE": "false",
    "ANDROID_CMAKE_VERSION": "3.22.1",
    "ANDROID_CMDLINE_TOOLS_VERSION": "19.0",
    "ANDROID_DISABLE_SNAPSHOTS": "0"
  },
  "packages": {
    "bash": "latest",
    "coreutils": "latest",
    "gnused": "latest",
    "gnugrep": "latest",
    "gawk": "latest",
    "jq": "latest",
    "jdk17": "latest",
    "gradle": "latest",
    "process-compose": "latest"
  },
  "create_files": {
    "{{ .Virtenv }}/android": "",
    "{{ .Virtenv }}/android/avd": "",
    "{{ .Virtenv }}/process-compose.yaml": "config/process-compose.yaml",
    "{{ .Virtenv }}/test-suite.yaml": "config/test-suite.yaml",
    "{{ .Virtenv }}/scripts/env.sh": "scripts/env.sh",
    "{{ .Virtenv }}/scripts/lib.sh": "scripts/lib.sh",
    "{{ .Virtenv }}/scripts/core.sh": "scripts/core.sh",
    "{{ .Virtenv }}/scripts/device_config.sh": "scripts/device_config.sh",
    "{{ .Virtenv }}/scripts/avd_manager.sh": "scripts/avd_manager.sh",
    "{{ .Virtenv }}/scripts/avd_reset.sh": "scripts/avd_reset.sh",
    "{{ .Virtenv }}/scripts/emulator.sh": "scripts/emulator.sh",
    "{{ .Virtenv }}/scripts/deploy.sh": "scripts/deploy.sh",
    "{{ .Virtenv }}/scripts/android.sh": "scripts/android.sh",
    "{{ .Virtenv }}/scripts/devices.sh": "scripts/devices.sh",
    "{{ .Virtenv }}/scripts/validate.sh": "scripts/validate.sh",
    "{{ .Virtenv }}/scripts/android-init.sh": "scripts/android-init.sh",
    "{{ .Virtenv }}/flake.nix": "config/flake.nix",
    "{{ .DevboxDir }}/devices/min.json": "config/devices/min.json",
    "{{ .DevboxDir }}/devices/max.json": "config/devices/max.json"
  },
  "shell": {
    "init_hook": [
      "bash {{ .Virtenv }}/scripts/android-init.sh 2>/dev/null || true",
      ". {{ .Virtenv }}/scripts/env.sh"
    ],
    "scripts": {
      "android:devices:eval": [
        "ANDROID_SDK_REQUIRED=0 android.sh devices eval"
      ],
      "build:android": [
        "echo 'Building Android app...'",
        "gradle assembleDebug --info"
      ],
      "build:android:debug": [
        "echo 'Building Android app with debug output...'",
        "gradle assembleDebug --debug --stacktrace"
      ],
      "test:android": [
        "gradle test"
      ],
      "test:android:e2e": [
        "echo 'Starting Android E2E tests...'",
        "android_start_emulator \"${1:-}\"",
        "gradle connectedAndroidTest",
        "android_stop_emulator"
      ],
      "test:e2e": [
        "process-compose -f {{ .Virtenv }}/test-suite.yaml --no-server --tui=${TEST_TUI:-true}"
      ],
      "start:emu": [
        "android_start_emulator \"${1:-}\""
      ],
      "start:android": [
        "android_deploy_app \"${1-}\""
      ],
      "stop:emu": [
        "android_stop_emulator"
      ],
      "reset:emu": [
        "echo 'Resetting Android emulators...'",
        "android_stop_emulator",
        "android_reset_avds"
      ],
      "doctor": [
        "echo 'Android Environment Check'",
        "echo '========================='",
        "echo ''",
        "echo 'ANDROID_SDK_ROOT:' ${ANDROID_SDK_ROOT:-'NOT SET'}",
        "test -n \"${ANDROID_SDK_ROOT}\" && echo '✓ ANDROID_SDK_ROOT is set' || echo '✗ ANDROID_SDK_ROOT is not set'",
        "test -d \"${ANDROID_SDK_ROOT}\" && echo '✓ ANDROID_SDK_ROOT directory exists' || echo '✗ ANDROID_SDK_ROOT directory does not exist'",
        "echo ''",
        "echo 'ANDROID_AVD_HOME:' ${ANDROID_AVD_HOME:-'NOT SET'}",
        "test -w \"${ANDROID_AVD_HOME}\" && echo '✓ ANDROID_AVD_HOME is writable' || echo '✗ ANDROID_AVD_HOME is not writable'",
        "echo ''",
        "command -v adb >/dev/null 2>&1 && echo '✓ adb is in PATH' || echo '✗ adb is not in PATH'",
        "command -v emulator >/dev/null 2>&1 && echo '✓ emulator is in PATH' || echo '✗ emulator is not in PATH'",
        "command -v avdmanager >/dev/null 2>&1 && echo '✓ avdmanager is in PATH' || echo '✗ avdmanager is not in PATH'",
        "echo ''",
        "echo 'Device Definitions:'",
        "ls -1 ${ANDROID_DEVICES_DIR}/*.json 2>/dev/null | wc -l | xargs echo '  Count:'",
        "echo '  ANDROID_DEVICES:' ${ANDROID_DEVICES:-'(all devices)'}",
        "echo ''",
        "test -f ${ANDROID_DEVICES_DIR}/devices.lock && echo '✓ Lock file exists' || echo '⚠ Lock file not generated yet (run devbox shell)'",
        "echo ''"
      ],
      "verify:setup": [
        "test -n \"${ANDROID_SDK_ROOT}\" && test -d \"${ANDROID_SDK_ROOT}\" && command -v adb >/dev/null 2>&1 && echo '✓ Android environment OK' || (echo '✗ Android environment check failed. Run: devbox run doctor' && exit 1)"
      ]
    }
  }
}
