{
  "packages": {
    "process-compose": "latest",
    "act":             "latest",
    "shellcheck":      "latest"
  },
  "shell": {
    "scripts": {
      "lint-android": [
        "echo 'Running shellcheck on Android plugin scripts...'",
        "shellcheck -S warning devbox/plugins/android/scripts/*.sh"
      ],
      "test-android-lib": [
        "echo 'Testing Android lib.sh functions...'",
        "bash devbox/plugins/tests/android/test-lib.sh"
      ],
      "test-android-devices": [
        "echo 'Testing Android devices.sh CLI...'",
        "bash devbox/plugins/tests/android/test-devices.sh"
      ],
      "test-android": [
        "devbox run lint-android",
        "devbox run test-android-lib",
        "devbox run test-android-devices"
      ],
      "lint-ios": [
        "echo 'Running shellcheck on iOS plugin scripts...'",
        "shellcheck -S warning devbox/plugins/ios/scripts/*.sh"
      ],
      "test-ios-lib": [
        "echo 'Testing iOS lib.sh functions...'",
        "sh devbox/plugins/tests/ios/test-lib.sh"
      ],
      "test-ios": [
        "devbox run lint-ios",
        "devbox run test-ios-lib"
      ],
      "lint-react-native": [
        "echo 'Running shellcheck on React Native plugin scripts...'",
        "shellcheck -S warning devbox/plugins/react-native/scripts/*.sh"
      ],
      "test-react-native": [
        "devbox run lint-react-native"
      ],
      "lint-all": [
        "echo 'Running shellcheck on all plugins...'",
        "shellcheck -S warning devbox/plugins/*/scripts/*.sh"
      ],
      "check-workflows": [
        "echo 'Checking GitHub workflow syntax...'",
        "for workflow in .github/workflows/*.yml; do",
        "  echo \"  Validating $(basename $workflow)...\"",
        "  act -W \"$workflow\" -l > /dev/null 2>&1 || {",
        "    echo \"    ✗ Syntax error in $workflow\"",
        "    act -W \"$workflow\" -l 2>&1 | head -20",
        "    exit 1",
        "  }",
        "  echo \"    ✓ $(basename $workflow)\"",
        "done",
        "echo 'All workflows valid!'"
      ],
      "sync-examples": [
        "echo '========================================='",
        "echo 'Syncing example projects with plugins'",
        "echo '========================================='",
        "echo ''",
        "echo '1/3 Syncing Android example...'",
        "(cd devbox/examples/android && rm -rf devbox.d devbox.lock .devbox && devbox install)",
        "echo '  Regenerating lockfile...'",
        "(cd devbox/examples/android && devbox run android.sh devices eval > /dev/null)",
        "echo '  ✓ Android example synced'",
        "echo ''",
        "echo '2/3 Syncing iOS example...'",
        "(cd devbox/examples/ios && rm -rf devbox.d devbox.lock .devbox && devbox install)",
        "echo '  Regenerating lockfile...'",
        "(cd devbox/examples/ios && devbox run ios.sh devices eval > /dev/null)",
        "echo '  ✓ iOS example synced'",
        "echo ''",
        "echo '3/3 Syncing React Native example...'",
        "(cd devbox/examples/react-native && rm -rf devbox.d devbox.lock .devbox && devbox install)",
        "echo '  Regenerating Android lockfile...'",
        "(cd devbox/examples/react-native && devbox run android.sh devices eval > /dev/null)",
        "echo '  Regenerating iOS lockfile...'",
        "(cd devbox/examples/react-native && devbox run ios.sh devices eval > /dev/null)",
        "echo '  ✓ React Native example synced'",
        "echo ''",
        "echo '========================================='",
        "echo '✓ All examples synced with latest plugins!'",
        "echo '========================================='",
        "echo ''",
        "echo 'Summary:'",
        "echo '  - Android: API 36 (devbox.d regenerated)'",
        "echo '  - iOS: Latest runtimes (devbox.d regenerated)'",
        "echo '  - React Native: API 35 via env overrides (devbox.d regenerated)'"
      ],
      "test-android-example-e2e": [
        "echo '========================================='",
        "echo 'E2E Test: Android Example'",
        "echo '========================================='",
        "echo '1/4 Building Android app...'",
        "(cd devbox/examples/android && devbox run --pure build-android)",
        "echo '2/4 Starting Android emulator...'",
        "(cd devbox/examples/android && devbox run --pure start-emu)",
        "echo '3/4 Deploying app to emulator...'",
        "(cd devbox/examples/android && devbox run --pure start-android)",
        "echo '4/4 Stopping emulator...'",
        "(cd devbox/examples/android && devbox run --pure stop-emu)",
        "echo '✓ Android example E2E test passed!'"
      ],
      "test-ios-example-e2e": [
        "echo '========================================='",
        "echo 'E2E Test: iOS Example'",
        "echo '========================================='",
        "echo '1/4 Building iOS app...'",
        "(cd devbox/examples/ios && devbox run --pure build-ios)",
        "echo '2/4 Starting iOS simulator...'",
        "(cd devbox/examples/ios && devbox run --pure start-sim)",
        "echo '3/4 Deploying app to simulator...'",
        "(cd devbox/examples/ios && devbox run --pure start-ios)",
        "echo '4/4 Stopping simulator...'",
        "(cd devbox/examples/ios && devbox run --pure stop-sim)",
        "echo '✓ iOS example E2E test passed!'"
      ],
      "test-react-native-example-e2e": [
        "echo '========================================='",
        "echo 'E2E Test: React Native Example'",
        "echo '========================================='",
        "echo '1/8 Installing Node dependencies...'",
        "(cd devbox/examples/react-native && devbox run --pure build-node)",
        "echo '2/8 Building web bundle...'",
        "(cd devbox/examples/react-native && devbox run --pure build-web)",
        "echo '3/8 Building Android app...'",
        "(cd devbox/examples/react-native && devbox run --pure build-android)",
        "echo '4/8 Starting Android emulator...'",
        "(cd devbox/examples/react-native && devbox run --pure start-emu)",
        "echo '5/8 Deploying Android app...'",
        "(cd devbox/examples/react-native && devbox run --pure start-android)",
        "(cd devbox/examples/react-native && devbox run --pure stop-emu)",
        "echo '6/8 Building iOS app...'",
        "(cd devbox/examples/react-native && devbox run --pure build-ios)",
        "echo '7/8 Starting iOS simulator...'",
        "(cd devbox/examples/react-native && devbox run --pure start-sim)",
        "echo '8/8 Deploying iOS app...'",
        "(cd devbox/examples/react-native && devbox run --pure start-ios)",
        "(cd devbox/examples/react-native && devbox run --pure stop-sim)",
        "echo '✓ React Native example E2E test passed!'"
      ],
      "test-examples-e2e": [
        "echo '========================================='",
        "echo 'Running E2E tests for all examples'",
        "echo 'Tests will run sequentially to avoid conflicts'",
        "echo '========================================='",
        "echo ''",
        "devbox run test-android-example-e2e",
        "echo ''",
        "devbox run test-ios-example-e2e",
        "echo ''",
        "devbox run test-react-native-example-e2e",
        "echo ''",
        "echo '========================================='",
        "echo '✓ All example E2E tests passed!'",
        "echo '========================================='",
        "echo ''",
        "echo 'Summary:'",
        "echo '  - Android example: build + emulator + deploy'",
        "echo '  - iOS example: build + simulator + deploy'",
        "echo '  - React Native example: build all + Android + iOS + web'"
      ],
      "test-all": [
        "echo '========================================='",
        "echo 'Running all tests and checks...'",
        "echo '========================================='",
        "echo ''",
        "echo '1/6 Linting all plugin scripts...'",
        "devbox run lint-all",
        "echo ''",
        "echo '2/6 Testing Android plugin...'",
        "devbox run test-android",
        "echo ''",
        "echo '3/6 Testing iOS plugin...'",
        "devbox run test-ios",
        "echo ''",
        "echo '4/6 Testing React Native plugin...'",
        "devbox run test-react-native",
        "echo ''",
        "echo '5/6 Validating GitHub workflows...'",
        "devbox run check-workflows",
        "echo ''",
        "echo '========================================='",
        "echo '✓ All tests passed!'",
        "echo '========================================='",
        "echo ''",
        "echo 'Summary:'",
        "echo '  - Shellcheck: all plugin scripts'",
        "echo '  - Android: lib.sh + devices.sh tests'",
        "echo '  - iOS: lib.sh tests'",
        "echo '  - React Native: lint checks'",
        "echo '  - GitHub Actions: workflow syntax validation'",
        "echo ''",
        "echo 'Note: Run \"devbox run test-examples-e2e\" for full E2E tests'"
      ]
    }
  }
}
