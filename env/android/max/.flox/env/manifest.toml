version = 1
[install]
android-sdk.flake = "github:segment-integrations/templates?dir=env/android/max"
android-tooling.flake = "github:segment-integrations/templates#android-tooling"
[vars]
[hook]
 on-activate = '''
  project_root="${PROJECT_ROOT:-$(git rev-parse --show-toplevel 2>/dev/null || pwd)}"
  if command -v android-tooling >/dev/null 2>&1; then
    # shellcheck disable=SC1091
    . "$(android-tooling --path)"
  elif [ -f "$project_root/scripts/android.sh" ]; then
    # Legacy shim kept for developers.
    # shellcheck disable=SC1091
    . "$project_root/scripts/android.sh"
  fi
 '''
[profile]
[services]
android-emulator-max.command = """
bash -lc '
set -euo pipefail

project_root="${PROJECT_ROOT:-$(git rev-parse --show-toplevel 2>/dev/null || pwd)}"
cd "$project_root"

arch="$(uname -m)"
default_avd="medium_phone_API33_x86_64"
if [ "$arch" = "arm64" ] || [ "$arch" = "aarch64" ]; then
  default_avd="medium_phone_API33_arm64_v8a"
fi

DETOX_AVD="${DETOX_AVD:-${ANDROID_AVD_MAX:-$default_avd}}" \
EMU_FOREGROUND=1 \
android-tooling start
'
"""
[include]
environments = [
    { dir = "../common" }
]
[build]
[options]
