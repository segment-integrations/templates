{
  "name": "react-native",
  "version": "0.0.1",
  "description": "Aggregates the Android and iOS Devbox plugins for React Native projects.",
  "include": [
    "path:../android/plugin.json",
    "path:../ios/plugin.json"
  ],
  "env": {
    "REACT_NATIVE_CONFIG_DIR": "{{ .DevboxDir }}",
    "REACT_NATIVE_SCRIPTS_DIR": "{{ .Virtenv }}/scripts"
  },
  "create_files": {
    "{{ .Virtenv }}/scripts/env.sh": "scripts/env.sh",
    "{{ .Virtenv }}/config/react-native.json": "config/react-native.json",
    "{{ .Virtenv }}/process-compose.yaml": "config/process-compose.yaml",
    "{{ .DevboxDir }}/react-native.json": "config/react-native.json"
  },
  "shell": {
    "init_hook": [
      ". {{ .Virtenv }}/scripts/env.sh"
    ],
    "scripts": {
      "build-node": [
        "npm install"
      ],
      "test": [
        "ANDROID_SDK_REQUIRED=0 npm test"
      ],
      "test-unit": [
        "ANDROID_SDK_REQUIRED=0 npm test"
      ],
      "build-android": [
        "devbox run --pure build-node",
        "cd android && gradle assembleDebug"
      ],
      "build-ios": [
        "devbox run --pure build-node",
        "cd ios && env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT:-*.xcodeproj} -scheme ${IOS_APP_SCHEME:-$(basename ${IOS_APP_PROJECT:-*.xcodeproj} .xcodeproj)} -configuration Debug -destination 'generic/platform=iOS Simulator' -derivedDataPath ../.devbox/virtenv/ios/DerivedData build"
      ],
      "test-android": [
        "devbox run --pure build-node",
        "cd android && gradle test"
      ],
      "test-android-e2e": [
        "devbox run --pure build-node",
        "devbox services start android-emulator || devbox services up -b android-emulator",
        "cd android && gradle connectedAndroidTest"
      ],
      "test-ios": [
        "devbox run --pure build-node",
        "cd ios && env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT:-*.xcodeproj} -scheme ${IOS_APP_SCHEME:-$(basename ${IOS_APP_PROJECT:-*.xcodeproj} .xcodeproj)} -configuration Debug -destination 'generic/platform=iOS Simulator' -derivedDataPath ../.devbox/virtenv/ios/DerivedData test"
      ],
      "test-ios-e2e": [
        "devbox run --pure build-node",
        "devbox services start ios-simulator || devbox services up -b ios-simulator",
        "cd ios && env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT:-*.xcodeproj} -scheme ${IOS_APP_SCHEME:-$(basename ${IOS_APP_PROJECT:-*.xcodeproj} .xcodeproj)} -configuration Debug -destination 'platform=iOS Simulator,name=${IOS_SIM_NAME:-iPhone 15}' -derivedDataPath ../.devbox/virtenv/ios/DerivedData test"
      ],
      "start-android": [
        "devbox services start rn-metro || devbox services up -b rn-metro",
        "npx react-native run-android --no-packager"
      ],
      "start-ios": [
        "devbox services start rn-metro || devbox services up -b rn-metro",
        "npx react-native run-ios --no-packager"
      ],
      "start-web": "devbox services start rn-metro || devbox services up rn-metro"
    }
  }
}
