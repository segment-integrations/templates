{
  "name": "ios",
  "version": "0.0.1",
  "description": "Configures iOS tooling inside Devbox and ensures Xcode toolchain usage.",
  "env": {
    "IOS_CONFIG_DIR": "{{ .DevboxDir }}",
    "IOS_DEVICES_DIR": "{{ .DevboxDir }}/devices",
    "IOS_SCRIPTS_DIR": "{{ .Virtenv }}/scripts",
    "IOS_DEFAULT_DEVICE": "max",
    "IOS_DEFAULT_RUNTIME": "",
    "IOS_APP_PROJECT": "ios.xcodeproj",
    "IOS_APP_SCHEME": "ios",
    "IOS_APP_BUNDLE_ID": "com.example.ios",
    "IOS_APP_ARTIFACT": ".devbox/virtenv/ios/DerivedData/Build/Products/Debug-iphonesimulator/ios.app",
    "IOS_APP_DERIVED_DATA": "",
    "IOS_DEVELOPER_DIR": "",
    "IOS_DOWNLOAD_RUNTIME": "1",
    "IOS_XCODE_ENV_PATH": ""
  },
  "packages": {
    "bash": "latest",
    "coreutils": "latest",
    "gnused": "latest",
    "gnugrep": "latest",
    "gawk": "latest",
    "jq": "latest",
    "cocoapods": {
      "version": "latest",
      "platforms": ["x86_64-darwin", "aarch64-darwin"]
    }
  },
  "create_files": {
    "{{ .Virtenv }}/process-compose.yaml": "config/process-compose.yaml",
    "{{ .Virtenv }}/scripts/lib.sh": "scripts/lib.sh",
    "{{ .Virtenv }}/scripts/env.sh": "scripts/env.sh",
    "{{ .Virtenv }}/scripts/validate.sh": "scripts/validate.sh",
    "{{ .Virtenv }}/scripts/device.sh": "scripts/device.sh",
    "{{ .Virtenv }}/scripts/simulator.sh": "scripts/simulator.sh",
    "{{ .Virtenv }}/scripts/deploy.sh": "scripts/deploy.sh",
    "{{ .Virtenv }}/scripts/config.sh": "scripts/config.sh",
    "{{ .Virtenv }}/scripts/ios.sh": "scripts/ios.sh",
    "{{ .Virtenv }}/scripts/devices.sh": "scripts/devices.sh",
    "{{ .Virtenv }}/scripts/ios-init.sh": "scripts/ios-init.sh",
    "{{ .DevboxDir }}/devices/min.json": "config/devices/min.json",
    "{{ .DevboxDir }}/devices/max.json": "config/devices/max.json",
    "{{ .DevboxDir }}/devices/devices.lock": "config/devices.lock.json"
  },
  "shell": {
    "init_hook": [
      "bash {{ .Virtenv }}/scripts/ios-init.sh 2>/dev/null || true",
      ". {{ .Virtenv }}/scripts/env.sh"
    ],
    "scripts": {
      "build-ios": [
        "env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT:-*.xcodeproj} -scheme ${IOS_APP_SCHEME:-$(basename ${IOS_APP_PROJECT:-*.xcodeproj} .xcodeproj)} -configuration Debug -destination 'generic/platform=iOS Simulator' -derivedDataPath ${IOS_APP_DERIVED_DATA:-.devbox/virtenv/ios/DerivedData} build"
      ],
      "test-ios": [
        "env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT:-*.xcodeproj} -scheme ${IOS_APP_SCHEME:-$(basename ${IOS_APP_PROJECT:-*.xcodeproj} .xcodeproj)} -configuration Debug -destination 'generic/platform=iOS Simulator' -derivedDataPath ${IOS_APP_DERIVED_DATA:-.devbox/virtenv/ios/DerivedData} test"
      ],
      "test-ios-e2e": [
        "echo 'Starting iOS E2E tests...'",
        ". {{ .Virtenv }}/scripts/simulator.sh",
        "ios_start \"${1:-}\"",
        "env -u LD -u LDFLAGS -u NIX_LDFLAGS -u NIX_CFLAGS_COMPILE -u NIX_CFLAGS_LINK xcodebuild -project ${IOS_APP_PROJECT:-*.xcodeproj} -scheme ${IOS_APP_SCHEME:-$(basename ${IOS_APP_PROJECT:-*.xcodeproj} .xcodeproj)} -configuration Debug -destination 'platform=iOS Simulator,name=${IOS_SIM_NAME:-iPhone 15}' -derivedDataPath ${IOS_APP_DERIVED_DATA:-.devbox/virtenv/ios/DerivedData} test",
        "ios_stop"
      ],
      "start-sim": [
        ". {{ .Virtenv }}/scripts/simulator.sh",
        "ios_start \"${1:-}\""
      ],
      "stop-sim": [
        ". {{ .Virtenv }}/scripts/simulator.sh",
        "ios_stop"
      ],
      "start-ios": [
        ". {{ .Virtenv }}/scripts/deploy.sh",
        "ios_run_app \"${1-}\""
      ]
    }
  }
}
